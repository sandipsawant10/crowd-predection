# Smart Crowd Management System

A web dashboard for monitoring and visualizing crowd detection and forecasting results from external ML systems.

## Overview

This system provides a web dashboard for monitoring crowd analytics through:

- **File-based result consumption** - Monitors detection and forecast files generated by external ML processes
- **Real-time visualization** - Interactive charts and tables for crowd data
- **File management** - Browse, select, and view result files with metadata
- **Live updates** - Automatic refresh when new result files appear
- **Passive monitoring** - No ML processing within this system

## Architecture

**IMPORTANT**: This system does NOT perform ML processing, video analysis, or AI computations. It is designed to consume and visualize results from external systems.

The system consists of:

1. **External ML System** - Processes videos and generates detection/forecast JSON files (handled outside this codebase)
2. **File Watcher Service** - Monitors results folder for new files
3. **Node.js API** - Serves file data and metadata to the dashboard
4. **React Dashboard** - Interactive visualization and file management interface

## Getting Started

### Prerequisites

- Node.js (v14+)
- MongoDB
- Python 3.8+
- npm or yarn

### Installation

#### 1. Clone the repository

```bash
git clone https://github.com/yourusername/smart-crowd-management.git
cd smart-crowd-management
```

#### 2. Backend Setup

```bash
cd dashboard/backend
npm install
```

Create a `.env` file:

```
MONGODB_URI=mongodb://localhost:27017/crowd-management
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRE=24h
PORT=5000
```

#### 3. Seed the Database

This will populate the database with sample data including cameras, crowd measurements, and user accounts:

```bash
npm run seed
```

#### 4. Start the Backend Server

```bash
npm run dev
```

#### 5. Frontend Setup

```bash
cd ../frontend
npm install
npm run dev
```

The frontend will be available at http://localhost:5173 or http://localhost:3000

### Default User Credentials

After running the seed script:

**Admin User:**

- Email: admin@crowdmanagement.com
- Password: Admin123!

**Standard User:**

- Email: user@crowdmanagement.com
- Password: User123!

## Features

### File Monitoring

- **Automatic Detection** - Monitors `results/` folder for new detection and forecast files
- **Real-time Updates** - Dashboard refreshes automatically when new files appear
- **File Metadata** - Shows file timestamps, sizes, and processing information

### Data Visualization

- **Detection Data** - Line charts and tables showing crowd counts over time
- **Forecast Data** - LSTM and linear prediction visualizations
- **Interactive Charts** - Zoom, filter, and explore data trends
- **Multiple Views** - Switch between chart and table views

### File Management

- **File Browser** - Browse available detection and forecast files
- **File Selection** - Click to view specific result files
- **File Statistics** - Summary of available files and data ranges
- **Auto-refresh** - Periodic updates to file listings

### Result File Support

- **Detection Files**: `detections_*.json` - Contains timestamp, frame, count, average_count, alert data
- **Forecast Files**: `forecast_*.json` - Contains LSTM predictions, linear predictions, and metadata
- **JSON Format** - Structured data with timestamps and processing metadata

## API Endpoints

### Results Files (Primary Endpoints)

- `GET /api/results/files` - List all detection and forecast files with metadata
- `GET /api/results/files/:filename` - Get contents of a specific result file
- `GET /api/results/latest/:type` - Get latest file of type 'detection' or 'forecast'
- `GET /api/results/stats` - Get file statistics and summary

### Authentication

- `POST /api/auth/login` - User login
- `POST /api/auth/register` - Register new user (admin only)

### Legacy Endpoints (Optional)

- `GET /api/crowd/latest` - Legacy endpoint (redirects to file-based data)
- `GET /api/crowd/history` - Legacy endpoint (redirects to file-based data)

**Note**: The primary functionality focuses on the `/api/results/*` endpoints that serve data from the monitored result files.

## File Format Specifications

### Detection Files (`detections_*.json`)

Expected format for detection result files:

```json
[
  {
    "timestamp": "2025-09-30T03:23:04.586548",
    "frame": 1,
    "count": 7,
    "average_count": 7.0,
    "alert": false
  },
  {
    "timestamp": "2025-09-30T03:23:04.870503",
    "frame": 2,
    "count": 8,
    "average_count": 7.5,
    "alert": false
  }
]
```

### Forecast Files (`forecast_*.json`)

Expected format for forecast result files:

```json
{
  "timestamp": "2025-09-30T03:23:18.967838",
  "frame": 30,
  "lstm_predictions": [12.66, 13.12, 13.73, 14.08, 14.87],
  "linear_predictions": [13.88, 14.1, 14.32, 14.54, 14.76],
  "model_metadata": {
    "version": "1.0",
    "confidence": 0.85
  }
}
```

### Integration Requirements

For external ML systems to integrate with this dashboard:

1. **File Location**: Place result files in the `results/` folder
2. **File Naming**: Use `detections_*.json` or `forecast_*.json` patterns
3. **File Format**: Follow the JSON structures shown above
4. **Auto-Detection**: Files are automatically detected when created/modified
5. **No API Calls**: No need to call any endpoints - file creation triggers updates

## Development

### Adding New Features

To add new features to the dashboard:

1. Create React components in `frontend/src/components/`
2. Add API endpoints in `backend/src/routes/`
3. Implement controllers in `backend/src/controllers/`
4. Create services as needed in `backend/src/services/`

### Running Tests

```bash
# Backend tests
cd dashboard/backend
npm run test

# Frontend tests
cd dashboard/frontend
npm run test
```

## Troubleshooting

### Common Issues

1. **MongoDB Connection Errors**

   - Ensure MongoDB is running
   - Verify connection string in `.env` file

2. **Missing Data on Dashboard**

   - Run the seed script to populate with sample data
   - Check browser console for API errors
   - Verify correct camera IDs are being referenced

3. **Authentication Issues**
   - Clear browser cookies and local storage
   - Reset user password in database if necessary

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Acknowledgments

- OpenCV for computer vision algorithms
- TensorFlow for prediction models
- MongoDB for database
- Express for API framework
- React for frontend library
